angular.module("horodata",["ngMaterial","ngRoute","ngMessages","gridshore.c3js.chart"]).config(["$mdDateLocaleProvider","$mdThemingProvider","$locationProvider","$routeProvider",function(e,t,n,r){var o;return moment.locale("fr"),t.theme("default").primaryPalette("blue").accentPalette("pink"),t.setDefaultTheme("default"),n.html5Mode(!0),r.when("/",{templateUrl:"horodata/views/index.html",controller:"Index"}).when("/:group",{templateUrl:"horodata/views/group.html",controller:"Group"}),o=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],e.month=o,e.days=["dimanche","lundi","mardi","mercredi","jeudi","venredi","samedi"],e.shortDays=["Di","Lu","Ma","Me","Je","Ve","Sa"],e.firstDayOfWeek=1,e.msgCalendar="Calendrier",e.msgOpenCalendar="Ouvrir le calendrier",e.monthHeaderFormatter=function(e){return o[e.getMonth()]+" "+e.getFullYear()}}]).run(["$http",function(e){return e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),angular.module("horodata").run(["$templateCache",function(e){e.put("horodata/menu/bottom_sheet.html",'<md-bottom-sheet class="md-list md-has-header" ng-cloak><md-subheader>Menu</md-subheader><md-list><md-list-item><md-button class=md-list-item-content><md-icon>trending_up</md-icon><span class=md-inline-list-icon-label>Plan et Quota</span></md-button></md-list-item><md-list-item><md-button class=md-list-item-content><md-icon>euro_symbol</md-icon><span class=md-inline-list-icon-label>Abonnement et Factures</span></md-button></md-list-item><md-list-item><md-button class=md-list-item-content ng-href="{{ home }}/account/logout"><md-icon>directions_run</md-icon><span class=md-inline-list-icon-label>Quitter</span></md-button></md-list-item></md-list></md-bottom-sheet>'),e.put("horodata/menu/sidenav.html",'<md-sidenav class="md-sidenav-left md-whiteframe-z2" md-component-id=sidenav md-is-locked-open="$mdMedia(\'gt-sm\')" layout=column><md-toolbar hide-gt-sm><div class=md-toolbar-tools><h1><md-icon class=md-24>access_time</md-icon>&nbsp; Horodata</h1><span flex></span><md-button ng-click=toggleSidenav() class=md-icon-button><md-icon class=md-24>close</md-icon></md-button></div></md-toolbar><md-content layout-padding hide show-gt-sm><div layout=column layout-align="center center"><div class=md-display-3><i class=material-icons style="font-size: 64px;">access_time</i></div><div class=md-headline>Horodata</div></div></md-content><md-content flex><section><md-subheader class=md-accent><div layout=row layout-align="space-between center"><span class=md-headline>Groupes</span><app-widgets-new-group layout-align=end></app-widgets-new-group></div></md-subheader><md-list flex layout=column class=md-body-1><md-list-item ng-repeat="group in groups()" ng-click=changeGroup(group.url)><span class=md-subhead ng-class="{\'group-selected\': currentGroupUrl == group.url}">{{group.name}}</span></md-list-item></md-list><section></section></section></md-content></md-sidenav>'),e.put("horodata/menu/toolbar.html",'<div><app-widgets-new-task></app-widgets-new-task><md-toolbar><div class=md-toolbar-tools><md-button hide-gt-sm class=md-icon-button aria-label=Settings ng-click=toggleSidenav()><md-icon class=md-24>menu</md-icon></md-button><h2><span>{{ MainTitle().title }}</span></h2><span flex></span><md-menu><md-button ng-click="openMenu($mdOpenMenu, $event)" class="md-fab md-mini" aria-label=Favorite><md-icon class=md-24>account_circle</md-icon><md-tooltip md-direction=left show-gt-md>Bonjour, {{ user.name }}</md-tooltip></md-button><md-menu-content width=4><md-menu-item><md-button ng-click=ctrl.redial($event)><md-icon>trending_up</md-icon>Plan et Quota</md-button></md-menu-item><md-menu-item><md-button><md-icon>euro_symbol</md-icon>Abonnement et Factures</md-button></md-menu-item><md-menu-divider></md-menu-divider><md-menu-item><md-button ng-href="{{ home }}/account/logout"><md-icon><i class=material-icons>directions_run</i></md-icon>Quitter</md-button></md-menu-item></md-menu-content></md-menu></div></md-toolbar></div>'),e.put("horodata/views/group.html",'<div><app-widgets-search-bar></app-widgets-search-bar><md-content><md-tabs md-dynamic-height md-border-bottom><md-tab label=Saisies><app-widgets-empty-group-boxed ng-if="group.tasks.length == 0 || group.customers.length == 0" group=group></app-widgets-empty-group-boxed><app-widgets-listing ng-if="group.tasks.length > 0 && group.customers.length > 0"></app-widgets-listing></md-tab><md-tab label=Statistiques><app-widgets-empty-group-boxed ng-if="group.tasks.length == 0 || group.customers.length == 0" group=group></app-widgets-empty-group-boxed><app-widgets-stats ng-if="group.tasks.length > 0 && group.customers.length > 0"></app-widgets-stats></md-tab><md-tab ng-if=isOwner label=Configuration layout=column layout-margin><app-widgets-configuration-guests></app-widgets-configuration-guests><md-divider></md-divider><app-widgets-configuration-customers></app-widgets-configuration-customers><md-divider></md-divider><app-widgets-configuration-tasks></app-widgets-configuration-tasks></md-tab></md-tabs></md-content></div>'),e.put("horodata/views/index.html","<div><app-new-group></app-new-group></div>"),e.put("horodata/views/new_task_form.html",'<md-dialog aria-label="Saisir une tâche" flex=40><div ng-if="group.tasks.length == 0 || group.customers.length == 0"><md-dialog-content><app-widgets-empty-group><app-widgets-empty-group></app-widgets-empty-group></app-widgets-empty-group></md-dialog-content><md-dialog-actions><md-button ng-click=close() class=md-raised>Fermer</md-button></md-dialog-actions></div><form ng-if="group.tasks.length > 0 && group.customers.length > 0" name=newTaskForm><md-toolbar><div class=md-toolbar-tools><h2>Saisir une tâche</h2><span flex></span><md-button class=md-icon-button aria-label=Fermer ng-click=close()><md-icon class=md-24>close</md-icon></md-button></div></md-toolbar><md-dialog-content><div class=md-dialog-content><div layout=column><md-input-container flex><label>Sélectionnez un dossier</label><md-select ng-model=task.customer><md-option ng-repeat="c in group.customers" value="{{ c.id }}">{{ c.name }}</md-option></md-select><small ng-if=errors.customer class=input-error>{{ errors.customer }}</small></md-input-container><md-input-container flex><label>Sélectionnez une tâche</label><md-select ng-model=task.task><md-option ng-repeat="t in group.tasks" value="{{ t.id }}">{{ t.name }}</md-option></md-select><small ng-if=errors.task class=input-error>{{ errors.task }}</small></md-input-container><div layout=row layout-align="space-between center"><md-input-container flex><label>Durée en heures</label><md-select ng-model=task.hours><md-option ng-repeat="h in hours" value="{{ h }}">{{ h }} <span ng-if="h > 1">heures</span> <span ng-if="h <= 1">heure</span></md-option></md-select><small ng-if=errors.duration class=input-error>{{ errors.duration }}</small></md-input-container><md-input-container flex><label>Durée en minutes</label><md-select ng-model=task.minutes><md-option ng-repeat="m in minutes" value="{{ m }}">{{ m }} <span ng-if="m > 1">minutes</span> <span ng-if="m <= 1">minute</span></md-option></md-select><small ng-if=errors.duration class=input-error>{{ errors.duration }}</small></md-input-container></div><md-input-container class=md-block ng-class="{\'md-input-invalid\': errors.comment}"><label>Commentaire</label> <textarea md-no-autogrow ng-model=task.comment rows=3 md-select-on-focus></textarea> <small ng-if=errors.comment class=input-error>{{ errors.comment }}</small></md-input-container></div></div></md-dialog-content><md-dialog-actions ng-if=!loading><md-button ng-click=send() class="md-primary md-raised">Ajouter</md-button><md-button ng-click=close() class=md-raised>Annuler</md-button></md-dialog-actions><md-dialog-actions ng-if=loading><md-progress-linear md-mode=indeterminate></md-progress-linear></md-dialog-actions></form></md-dialog>'),e.put("horodata/widgets/empty_group.html",'<div layout-padding layout-margin layout=column layout-align="center center"><div ng-if="group.tasks.length == 0 && group.customers.length == 0"><div class="md-headline input-error">Le groupe ne présente aucun dossier et type</div><p>Vous devez ajouter des dossiers et des types pour permettre la saisie de tâches. Cliquez sur l\'onglet "Configuration" pour en ajouter.</p></div><div ng-if="group.tasks.length > 0 && group.customers.length == 0"><div class="md-headline input-error">Le groupe ne présente aucun dossier</div><p>Vous devez ajouter des dossiers pour permettre la saisie de tâches. Cliquez sur l\'onglet "Configuration" pour en ajouter.</p></div><div ng-if="group.tasks.length == 0 && group.customers.length > 0"><div class="md-headline input-error">Le groupe ne présente aucun type</div><p>Vous devez ajouter des types pour permettre la saisie de tâches. Cliquez sur l\'onglet "Configuration" pour en ajouter.</p></div></div>'),e.put("horodata/widgets/empty_group_boxed.html",'<div layout=row flex layout-align="center center"><md-whiteframe class="md-whiteframe-1dp md-accent" flex=100 flex-sm=70 flex-md=60 flex-gt-md=50 layout-padding layout-margin layout=column><app-widgets-empty-group><app-widgets-empty-group></app-widgets-empty-group></app-widgets-empty-group></md-whiteframe></div>'),e.put("horodata/widgets/listing.html",'<div><div ng-if=!listing.data() layout=column layout-align="center center"><md-progress-circular md-mode=indeterminate md-diameter=150></md-progress-circular><p>Chargement, veuillez patienter.</p></div><div ng-if=listing.data()><md-list class=md-body-1><md-list-item class=md-body-2 hide show-gt-md><div layout=row layout-align="space-between center" flex><div flex=15>Jour</div><div ng-if=isOwner flex=25>Utilisateur</div><div flex=25>Dossier</div><div flex=25>Tâche</div><div flex=10>Durée</div></div><md-divider></md-divider></md-list-item><md-list-item ng-repeat="i in listing.data()" ng-click=alert($event) hide show-gt-md><div layout=row layout-align="space-between center" flex><div flex=15>{{ i.created | Day }}</div><div flex=25 ng-if=isOwner>{{ guests[i.creator_id].full_name }}</div><div flex=25>{{ customers[i.customer_id].name }}</div><div flex=25>{{ tasks[i.task_id].name }}</div><div flex=10>{{ i.duration | Duration }}</div></div><md-divider></md-divider></md-list-item><md-list-item ng-repeat="i in listing.data()" class=md-2-line ng-click=alert($event) hide-gt-md><div class=md-list-item-text layout=column><div layout=row layout-align="space-between center"><h3>{{ customers[i.customer_id].name }}</h3><h4>{{ i.created | Day }} - <span class=text-primary>{{ i.duration | Duration }}</span></h4></div><h4>{{ tasks[i.task_id].name }}</h4><span class=text-accent>{{ guests[i.creator_id].full_name }}</span></div><md-divider></md-divider></md-list-item></md-list></div></div>'),e.put("horodata/widgets/loading.html",'<div layout=column layout-align="center center" flex><md-progress-circular md-mode=indeterminate md-diameter=150></md-progress-circular><p>Chargement, veuillez patienter.</p></div>'),e.put("horodata/widgets/new_group.html",'<md-button class="md-fab md-primary md-mini" ng-click=showNewGroupDialog($event) aria-label="Créer un groupe"><md-icon class=md-24>add</md-icon><md-tooltip md-direction=top>Créer un groupe</md-tooltip></md-button>'),e.put("horodata/widgets/new_group_form.html",'<md-dialog aria-label="Créer un groupe" flex=40><form name=newGroupForm><md-toolbar><div class=md-toolbar-tools><h2>Créer un groupe</h2><span flex></span><md-button class=md-icon-button aria-label=Fermer ng-click=close()><md-icon class=md-24>close</md-icon></md-button></div></md-toolbar><md-dialog-content><div class=md-dialog-content><md-input-container class=md-block ng-class="{\'md-input-invalid\': errors.name}"><label>Nom du groupe</label> <input type=text ng-model=name> <small ng-if=errors.name class=input-error>{{ errors.name }}</small></md-input-container></div></md-dialog-content><md-dialog-actions ng-if=!loading><md-button ng-click=send() class="md-primary md-raised">Créer</md-button><md-button ng-click=close() class=md-raised>Annuler</md-button></md-dialog-actions><md-dialog-actions ng-if=loading><md-progress-linear md-mode=indeterminate></md-progress-linear></md-dialog-actions></form></md-dialog>'),e.put("horodata/widgets/new_task.html",'<md-button ng-if=MainTitle().canEdit class="md-fab md-fab-bottom-right" aria-label=Add ng-click=showNewTaskDialog($event)><md-tooltip md-direction=left>Saisir une tâche</md-tooltip><md-icon class=md-48 style="margin: -2px 0px 0px -1px">access_time</md-icon></md-button>'),e.put("horodata/widgets/search_bar.html",'<div><div layout=row layout-align="space-around center" hide show-gt-md layout-padding><md-datepicker flex=25 ng-model=search.begin md-placeholder="Date début" md-max-date=search.end></md-datepicker><md-datepicker flex=25 ng-model=search.end md-placeholder="Date fin" md-max-date=today></md-datepicker><div flex=25><div layout=row><md-input-container flex><label>Dossier</label><md-select ng-model=search.customer><md-option ng-repeat="c in group.customers" value="{{ c.id }}">{{ c.name }}</md-option></md-select></md-input-container><md-button ng-click="search.customer = null" ng-if=search.customer class="md-fab md-mini" aria-label=désélectionner><md-icon>close</md-icon></md-button></div></div><div flex=25 ng-if=isOwner><div layout=row><md-input-container flex><label>Utilisateur</label><md-select ng-model=search.guest><md-option ng-repeat="u in group.guests" ng-if=u.full_name value="{{ u.id }}">{{ u.full_name }}</md-option></md-select></md-input-container><md-button ng-click="search.guest = null" ng-if=search.guest class="md-fab md-mini" aria-label=désélectionner><md-icon>close</md-icon></md-button></div></div></div><md-divider></md-divider></div>'),e.put("horodata/widgets/stats.html",'<div layout=column layout-padding><div layout=row><md-input-container flex><md-select ng-model=selected placeholder="Choisissez une statistique"><md-option ng-value=s.id ng-repeat="s in availableStats">{{ s.label }}</md-option></md-select></md-input-container></div><div ng-switch=selected flex><app-widgets-stats-customer-time ng-switch-when=customer_time><app-widgets-stats-customer-time></app-widgets-stats-customer-time></app-widgets-stats-customer-time></div></div>'),e.put("horodata/widgets/configuration/customers.html",'<div layout-margin layout-padding><div layout=column flex-sm=70 flex-md=80 flex-gt-md=60><div layout=row layout-align="space-between center"><div class=md-display-1>Dossiers</div><md-button ng-click=customers.create($event) class="md-raised md-primary" hide show-gt-sm><md-icon class=md-18>add</md-icon>Ajouter</md-button><md-button ng-click=customers.create($event) class="md-fab md-primary" hide-gt-sm aria-label="Ajouter de nouveaux dossiers"><md-tooltip md-direction=top>Ajouter de nouveaux dossiers</md-tooltip><md-icon class=md-36>add</md-icon></md-button></div><p class=md-body-1>Listez l\'ensemble des dossiers sur lesquels travaillent vos collaborateurs.<br>Les dossiers peuvent représenter vos client ou diverses projets.</p><md-whiteframe ng-if="group.customers.length == 0" class="md-whiteframe-1dp md-accent" layout-padding layout=column layout-align="center center"><div class="md-headline input-error">Aucun dossier</div><div>Ajouter des dossiers pour permettre la saisie de tâches.</div></md-whiteframe><div layout=row ng-if="group.customers.length > 0"><md-input-container flex><label>Sélectionnez un dossier</label><md-select ng-model=customers.selected><md-option ng-repeat="c in group.customers" value="{{ c.id }}">{{ c.name }}</md-option></md-select></md-input-container><md-button ng-if=customers.selected ng-click=customers.edit($event) class="md-fab md-mini md-accent" aria-label="Modifier le dossier"><md-tooltip md-direction=top>Modifier le dossier</md-tooltip><md-icon class=md-24>edit</md-icon></md-button></div></div></div>'),e.put("horodata/widgets/configuration/customers_create_form.html",'<md-dialog aria-label="Ajouter de nouveaux dossiers" flex=40><form name=newCustomerForm><md-toolbar><div class=md-toolbar-tools><h2>Ajouter de nouveaux dossiers</h2><span flex></span><md-button class=md-icon-button aria-label=Fermer ng-click=close()><md-icon class=md-24>close</md-icon></md-button></div></md-toolbar><md-dialog-content><div class=md-dialog-content><md-input-container class=md-block ng-class="{\'md-input-invalid\': errors.customers}"><label>Nom des dossiers (un dossier par ligne)</label> <textarea md-no-autogrow ng-model=customers.current.customers rows=5 md-select-on-focus></textarea> <small ng-if=errors.customers class=input-error>{{ errors.customers }}</small></md-input-container></div></md-dialog-content><md-dialog-actions ng-if=!loading><md-button ng-click=create() class="md-primary md-raised">Ajouter</md-button><md-button ng-click=close() class=md-raised>Annuler</md-button></md-dialog-actions><md-dialog-actions ng-if=loading><md-progress-linear md-mode=indeterminate></md-progress-linear></md-dialog-actions></form></md-dialog>'),e.put("horodata/widgets/configuration/customers_edit_form.html",'<md-dialog aria-label="Modifier le dossier" flex=40><form name=editCustomerForm><md-toolbar><div class=md-toolbar-tools><h2>Modifier le dossier</h2><span flex></span><md-button class=md-icon-button aria-label=Fermer ng-click=close()><md-icon class=md-24>close</md-icon></md-button></div></md-toolbar><md-dialog-content><div class=md-dialog-content><md-input-container class=md-block ng-class="{\'md-input-invalid\': errors.name}"><label>Nom du dossier</label> <input md-maxlength=40 type=text ng-model=customers.current.name> <small ng-if=errors.name class=input-error>{{ errors.name }}</small></md-input-container></div></md-dialog-content><md-dialog-actions ng-if=!loading><md-button ng-click=edit() class="md-primary md-raised">Modifier</md-button><md-button ng-click=delete() class="md-warn md-raised">Supprimer</md-button><md-button ng-click=close() class=md-raised>Annuler</md-button></md-dialog-actions><md-dialog-actions ng-if=loading><md-progress-linear md-mode=indeterminate></md-progress-linear></md-dialog-actions></form></md-dialog>'),e.put("horodata/widgets/configuration/guests.html",'<div layout-margin layout-padding><div layout=column flex-sm=70 flex-md=80 flex-gt-md=60><div layout=row layout-align="space-between center"><div class=md-display-1>Utilisateurs</div><md-button ng-click=guests.create($event) class="md-raised md-primary" hide show-gt-sm><md-icon class=md-18>add</md-icon>Ajouter</md-button><md-button ng-click=guests.create($event) class="md-fab md-primary" hide-gt-sm aria-label="Ajouter un nouvel utilisateur"><md-tooltip md-direction=top>Ajouter un nouvel utilisateur</md-tooltip><md-icon class=md-36>add</md-icon></md-button></div><p class=md-body-1>Invitez vos collaborateurs à saisir leurs tâches dans Horodata.<br></p><div layout=row ng-if="group.guests.length > 0"><md-input-container flex><label>Selectionnez un utilisateur</label><md-select ng-model=guests.selected><md-option ng-repeat="g in group.guests" value="{{ g.id }}"><span ng-if=!g.full_name>{{ g.email }}</span> <span ng-if=g.full_name>{{ g.full_name }} <small>{{ g.email }}</small></span></md-option></md-select></md-input-container><md-button ng-if=guests.selected ng-click=guests.edit($event) class="md-fab md-mini md-accent" aria-label="Editer une tâche"><md-tooltip md-direction=top>Modifier l\'utilisateur</md-tooltip><md-icon class=md-24>edit</md-icon></md-button></div></div></div>'),e.put("horodata/widgets/configuration/guests_create_form.html",'<md-dialog aria-label="Ajouter un nouvel utilisateur" flex=40><form name=newUserForm><md-toolbar><div class=md-toolbar-tools><h2>Ajouter un nouvel utilisateur</h2><span flex></span><md-button class=md-icon-button aria-label=Fermer ng-click=close()><md-icon class=md-24>close</md-icon></md-button></div></md-toolbar><md-dialog-content><div class=md-dialog-content><md-input-container class=md-block ng-class="{\'md-input-invalid\': errors.email}"><label>Adresse email</label> <input type=text md-maxlength=100 ng-model=guests.current.email> <small ng-if=errors.email class=input-error>{{ errors.email }}</small></md-input-container><md-input-container class=md-block ng-class="{\'md-input-invalid\': errors.rate}"><label>Taux horaire</label> <input type=number ng-model=guests.current.rate ng-value=0> <small ng-if=errors.rate class=input-error>{{ errors.rate }}</small></md-input-container><md-input-container class=md-block ng-class="{\'md-input-invalid\': errors.admin}"><md-switch ng-model=guests.current.admin aria-label="Droit administrateur">Droit administrateur</md-switch><div class=input-hint>Cochez la case, si vous souhaitez autoriser cet utilisateur, à accéder à la configuration et aux données de tous les utilisateurs du groupe.</div><small ng-if=errors.admin class=input-error>{{ errors.admin }}</small></md-input-container></div></md-dialog-content><md-dialog-actions ng-if=!loading><md-button ng-click=create() class="md-primary md-raised">Ajouter</md-button><md-button ng-click=close() class=md-raised>Annuler</md-button></md-dialog-actions><md-dialog-actions ng-if=loading><md-progress-linear md-mode=indeterminate></md-progress-linear></md-dialog-actions></form></md-dialog>'),e.put("horodata/widgets/configuration/guests_edit_form.html",'<md-dialog aria-label="Modifier l\'utilisateur" flex=40><form name=newUserForm><md-toolbar><div class=md-toolbar-tools><h2>Modifier l\'utilisateur <span ng-if=!guests.current.full_name>{{ guests.current.email }}</span> <span ng-if=guests.current.full_name>{{ guests.current.full_name }}</span></h2><span flex></span><md-button class=md-icon-button aria-label=Fermer ng-click=close()><md-icon class=md-24>close</md-icon></md-button></div></md-toolbar><md-dialog-content><div class=md-dialog-content><md-input-container class=md-block ng-class="{\'md-input-invalid\': errors.rate}"><label>Taux horaire</label> <input type=number ng-model=guests.current.rate ng-value=0> <small ng-if=errors.rate class=input-error>{{ errors.rate }}</small></md-input-container><md-input-container class=md-block ng-class="{\'md-input-invalid\': errors.admin}"><md-switch ng-model=guests.current.admin aria-label="Droit administrateur">Droit administrateur</md-switch><div class=input-hint>Cochez la case, si vous souhaitez autoriser cet utilisateur, à accéder à la configuration et aux données de tous les utilisateurs du groupe.</div><small ng-if=errors.admin class=input-error>{{ errors.admin }}</small></md-input-container></div></md-dialog-content><md-dialog-actions ng-if=!loading><md-button ng-click=edit() class="md-primary md-raised">Modifier</md-button><md-button ng-click=delete() class="md-warn md-raised">Supprimer</md-button><md-button ng-click=close() class=md-raised>Annuler</md-button></md-dialog-actions><md-dialog-actions ng-if=loading><md-progress-linear md-mode=indeterminate></md-progress-linear></md-dialog-actions></form></md-dialog>'),e.put("horodata/widgets/configuration/tasks.html",'<div layout-margin layout-padding><div layout=column flex-sm=70 flex-md=80 flex-gt-md=60><div layout=row layout-align="space-between center"><div class=md-display-1>Types de tâche</div><md-button ng-click=tasks.create($event) class="md-raised md-primary" hide show-gt-sm><md-icon class=md-18>add</md-icon>Ajouter</md-button><md-button ng-click=tasks.create($event) class="md-fab md-primary" hide-gt-sm aria-label="Ajouter un type de tâche"><md-tooltip md-direction=top>Ajouter un type de tâche</md-tooltip><md-icon class=md-36>add</md-icon></md-button></div><p class=md-body-1>Listez les types de tâche qu\'accomplissent vos collaborateurs.</p><md-whiteframe ng-if="group.tasks.length == 0" class="md-whiteframe-1dp md-accent" layout-padding layout=column layout-align="center center"><div class="md-headline input-error">Aucun type de tâche</div><div>Ajouter des types pour permettre la saisie de tâches.</div></md-whiteframe><div layout=row ng-if="group.tasks.length > 0"><md-input-container flex><label>Sélectionnez un type de tâche</label><md-select ng-model=tasks.selected><md-option ng-repeat="t in group.tasks" value="{{ t.id }}">{{ t.name }} <small ng-if=t.comment_mandatory>(Commentaire obligatoire)</small></md-option></md-select></md-input-container><md-button ng-if=tasks.selected ng-click=tasks.edit($event) class="md-fab md-mini md-accent" aria-label="Editer une tâche"><md-tooltip md-direction=top>Modifier la tâche</md-tooltip><md-icon class=md-24>edit</md-icon></md-button></div></div></div>'),e.put("horodata/widgets/configuration/tasks_form.html",'<md-dialog aria-label="Ajouter un nouveau type de tâche" flex=40><form name=newTaskForm><md-toolbar><div class=md-toolbar-tools><h2>Ajouter un nouveau type de tâche</h2><span flex></span><md-button class=md-icon-button aria-label=Fermer ng-click=close()><md-icon class=md-24>close</md-icon></md-button></div></md-toolbar><md-dialog-content><div class=md-dialog-content><md-input-container class=md-block ng-class="{\'md-input-invalid\': errors.name}"><label>Nom de la tâche</label> <input md-maxlength=30 type=text ng-model=tasks.current.name> <small ng-if=errors.name class=input-error>{{ errors.name }}</small></md-input-container><md-input-container class=md-block ng-class="{\'md-input-invalid\': errors.admin}"><md-switch ng-model=tasks.current.comment_mandatory aria-label="Commentaire obligatoire">Commentaire obligatoire</md-switch><div class=input-hint>Cochez la case, si vous souhaitez rendre le commentaire obligatoire.</div></md-input-container></div></md-dialog-content><md-dialog-actions ng-if=!loading><md-button ng-if=!tasks.current.id ng-click=create() class="md-primary md-raised">Ajouter</md-button><md-button ng-if=tasks.current.id ng-click=edit() class="md-primary md-raised">Modifier</md-button><md-button ng-if=tasks.current.id ng-click=delete() class="md-warn md-raised">Supprimer</md-button><md-button ng-click=close() class=md-raised>Annuler</md-button></md-dialog-actions><md-dialog-actions ng-if=loading><md-progress-linear md-mode=indeterminate></md-progress-linear></md-dialog-actions></form></md-dialog>'),e.put("horodata/widgets/stats/customer_time.html",'<div layout=column><app-widgets-loading ng-if=stats.loading()></app-widgets-loading><div ng-if=!stats.loading() flex><div id=chart></div><c3chart bindto-id=chart ng-if=data><chart-column ng-repeat="i in data" column-id="{{ customers[i.customer_id].name }}" column-values="{{ i.duration }}" column-type=pie></chart-column></c3chart></div></div>')}]),angular.module("horodata").directive("appMenuSidenav",["$mdSidenav","$http","$location","apiService","$routeParams","groupNewService",function(e,t,n,r,o,i){var a;return a=function(t,r){return t.toggleSidenav=function(){return e("sidenav").toggle()},t.closeSidenav=function(){return e("sidenav").close()},i.fetch(),t.groups=function(){return i.listing()},t.changeGroup=function(e){return t.closeSidenav(),n.path(e)},t.$on("$routeChangeSuccess",function(){return t.currentGroupUrl=o.group,t.closeSidenav()})},{link:a,replace:!0,restrict:"E",templateUrl:"horodata/menu/sidenav.html"}}]),angular.module("horodata").directive("appMenuToolbar",["titleService","userService","homeService","$mdMedia","$mdBottomSheet",function(e,t,n,r,o){var i;return i=function(i,a){return i.MainTitle=e.get,t.get(function(e){return i.user=e}),i.home=n.get(),i.openMenu=function(e,t){return r("xs")||r("sm")?o.show({templateUrl:"horodata/menu/bottom_sheet.html"}):e(t)}},{link:i,replace:!0,restrict:"E",templateUrl:"horodata/menu/toolbar.html"}}]),angular.module("horodata").controller("Group",["$http","$routeParams","$scope","titleService","userService","apiService","groupNewService","popupService","listingService",function(e,t,n,r,o,i,a,s,d){var l,u;return n.isGroupView=!0,n.search={begin:moment().subtract(1,"months").toDate(),end:new Date,customer:null,guest:null},n.$watch("search",function(e){return null!=e?(d.search(t.group,e),d.listing().fetch(1)):void 0},!0),l=function(){return e.get(i.get()+"/groups/"+t.group+"/users").then(function(e){return n.users=e.data.data})},n.isOwner=!1,u=function(){return e.get(i.get()+"/groups/"+t.group).then(function(e){return n.group=e.data.data,n.isOwner=n.group.owner===n.user.id,n.tasks=_.keyBy(n.group.tasks,"id"),n.customers=_.keyBy(n.group.customers,"id"),n.guests=_.keyBy(n.group.guests,"id"),r.set(n.group.name,!0)})},o.get(function(e){return n.user=e,u(),n.isOwner?l():void 0}),n.$on("group.reload",function(e){return e.stopPropagation(),u()}),a.set(function(e){return s("horodata/views/new_task_form.html","groupNewTaskDialog",n,e)})}]),angular.module("horodata").controller("groupNewTaskDialog",["$scope","$mdDialog","$mdToast","$http","$location","apiService","listingService",function(e,t,n,r,o,i,a){var s;return e.task={minutes:0,hours:0},e.errors=null,e.loading=!1,e.hours=[0,1,2,3,4,5,6,7,8,9,10,11,12],e.minutes=function(){var e,t;for(t=[],s=e=0;55>=e;s=e+=5)t.push(s);return t}(),e.close=function(){return t.hide()},e.send=function(){var o;return o={duration:3600*e.task.hours+60*e.task.minutes,task:parseInt(e.task.task),customer:parseInt(e.task.customer),comment:e.task.comment},e.loading=!0,r.post(i.get()+"/groups/"+e.group.url+"/jobs",o).then(function(e){return t.hide(),n.showSimple("Nouvelle tâche saisie"),a.listing().fetch()},function(t){return e.loading=!1,e.errors=t.data.errors})}}]),angular.module("horodata").controller("Index",["$http","$scope","userService","titleService",function(e,t,n,r){return r.set("Accueil")}]),angular.module("horodata").factory("apiService",[function(){var e;return e=document.getElementsByTagName("api")[0].getAttribute("href"),{get:function(){return e}}}]),angular.module("horodata").filter("Day",[function(){return function(e){return moment(e).format("LL")}}]),angular.module("horodata").filter("Ago",[function(){return function(e){return moment(e).fromNow()}}]),angular.module("horodata").filter("Duration",[function(){return function(e){var t,n,r;return t=moment.duration(e,"seconds"),r=t.minutes(),10>r&&(r="0"+r),n=t.hours(),n+"h"+r}}]),angular.module("horodata").factory("groupNewService",["apiService","$http",function(e,t){var n,r,o;return n=null,o=[],r=function(){return t.get(e.get()+"/groups").then(function(e){return o=e.data.data.results})},{set:function(e){return n=e},open:function(e){return n(e)},listing:function(){return o},fetch:function(){return r()}}}]),angular.module("horodata").factory("homeService",[function(){var e;return e=document.getElementsByTagName("home")[0].getAttribute("href"),{get:function(){return e}}}]);var bind=function(e,t){return function(){return e.apply(t,arguments)}};angular.module("horodata").factory("listingService",["$http","apiService",function(e,t){var n,r;return n=function(){function n(e,t,n,r,o){this.groupUrl=e,this.fetch=bind(this.fetch,this),this.size=100,this.page=1,this.list=null,this.loading=!1,this.total=-1,this.params={begin:moment(t).format("YYYY-MM-DD"),end:moment(n).format("YYYY-MM-DD"),customer:r,guest:o}}return n.prototype.pages=function(){var e;return-1===this.total?null:e={page:this.page,prev:1===this.page?null:this.page-1,next:this.page*this.size>this.total?null:this.page+1}},n.prototype.fetch=function(n){var r;if(!this.loading)return this.loading=!0,r=_.cloneDeep(this.params),null==n&&(n=this.page),this.page=n,r.offset=(n-1)*this.size,r.size=this.size,e.get(t.get()+"/groups/"+this.groupUrl+"/jobs",{params:r}).then(function(e){return function(t){return e.list=t.data.data.results,e.loading=!1,e.total=t.data.data.total}}(this),function(e){return function(t){return console.log(t.error),e.loading=!1}}(this))},n}(),r={},{data:function(){return null==r.list||r.loading,r.list},listing:function(){return r},search:function(e,t){return r=new n(e,t.begin,t.end,t.customer,t.guest)},pages:function(){return r.pages()}}}]),angular.module("horodata").factory("popupService",["$mdMedia","$mdDialog",function(e,t){return function(n,r,o,i){var a;return a=e("xs")||e("sm"),t.show({controller:r,templateUrl:n,parent:angular.element(document.body),targetEvent:i,
preserveScope:!0,scope:o,clickOutsideToClose:!0,escapeToClose:!0,fullscreen:a})}}]),angular.module("horodata").factory("searchUsersService",[function(){var e;return e=function(){function e(e){var t,n,r,o;for(this.items=e,this.selected=null,this.searchText="",this.index=lunr(function(){return this.field("name"),this.field("email"),this.ref("index")}),t=n=0,o=this.items.length-1;o>=0?o>=n:n>=o;t=o>=0?++n:--n)r={name:this.items[t].name,email:this.items[t].email,index:t},this.items[t]=r,this.index.add(r)}return e.prototype.search=function(e){var t,n,r,o,i;if(""===e)return this.items;for(i=this.index.search(e),t=[],r=0,o=i.length;o>r;r++)n=i[r],t.push(this.items[n.ref]);return t},e.prototype.select=function(e){return this.selected=e},e}(),{get:function(t){return new e(t)}}}]),angular.module("horodata").factory("statsService",["apiService","$http",function(e,t){var n,r;return r=!1,n=function(n,o,i,a){var s;return s={begin:moment(i.begin).format("YYYY-MM-DD"),end:moment(i.end).format("YYYY-MM-DD"),guest:i.guest},r=!0,t.get(e.get()+"/groups/"+n+"/stats/"+o,{params:s}).then(function(e){return r=!1,a(e.data.data)},function(e){return cd(null),r=!1})},{fetch:function(e,t,r,o){return n(e,t,r,o)},data:function(){return data},loading:function(){return r}}}]),angular.module("horodata").factory("titleService",[function(){var e;return e={title:"",canEdit:!1},{get:function(){return e},set:function(t,n){return null==n&&(n=!1),e.title=t,e.canEdit=n}}}]),angular.module("horodata").factory("userService",["$http","apiService",function(e,t){var n,r,o,i;return i=null,r=e.get(t.get()+"/users/me"),n=function(e){return null==i?r.then(function(t){return i=t.data.data,e(i)}):e(i)},o=function(e){return i=e},{get:n,update:o}}]),angular.module("horodata").directive("appWidgetsEmptyGroup",[function(){return{restrict:"E",templateUrl:"horodata/widgets/empty_group.html"}}]),angular.module("horodata").directive("appWidgetsEmptyGroupBoxed",[function(){return{restrict:"E",templateUrl:"horodata/widgets/empty_group_boxed.html"}}]),angular.module("horodata").directive("appWidgetsListing",["listingService","$timeout","$location",function(e,t,n){var r;return r=function(t){return t.listing=e,t.goTo=function(t){return n.search("page",t),e.listing().fetch(t)}},{link:r,replace:!0,restrict:"E",templateUrl:"horodata/widgets/listing.html"}}]),angular.module("horodata").directive("appWidgetsLoading",[function(){return{replace:!0,restrict:"E",templateUrl:"horodata/widgets/loading.html"}}]),angular.module("horodata").directive("appWidgetsNewGroup",["popupService",function(e){var t;return t=function(t){return t.showNewGroupDialog=function(n){return e("horodata/widgets/new_group_form.html","newGroupDialog",t,n)}},{link:t,restrict:"E",templateUrl:"horodata/widgets/new_group.html"}}]),angular.module("horodata").controller("newGroupDialog",["$scope","$mdDialog","$mdToast","$http","$location","apiService","groupNewService",function(e,t,n,r,o,i,a){return e.name="",e.errors=null,e.loading=!1,e.close=function(){return t.hide()},e.send=function(){return e.loading=!0,r.post(i.get()+"/groups",{name:e.name}).then(function(e){var r;return r=e.data.data,t.hide(),n.showSimple("Nouveau groupe '"+r.name+"' créé"),o.path("/"+r.url),a.fetch()},function(t){return e.loading=!1,e.errors=t.data.errors})}}]),angular.module("horodata").directive("appWidgetsNewTask",["groupNewService",function(e){var t;return t=function(t){return t.showNewTaskDialog=function(t){return e.open(t)}},{link:t,restrict:"E",templateUrl:"horodata/widgets/new_task.html"}}]),angular.module("horodata").directive("appWidgetsSearchBar",[function(){var e;return e=function(e){return e.today=new Date},{link:e,replace:!0,restrict:"E",templateUrl:"horodata/widgets/search_bar.html"}}]),angular.module("horodata").directive("appWidgetsStats",[function(){var e;return e=function(e){return e.availableStats=[{id:"customer_time",label:"Repartition du temps par dossier."}],e.selected=null},{link:e,replace:!0,restrict:"E",templateUrl:"horodata/widgets/stats.html"}}]),angular.module("horodata").directive("appWidgetsConfigurationCustomers",["popupService",function(e){var t;return t=function(t,n,r){return t.customers={current:null,selected:null,edit:function(n){return this.current=_.cloneDeep(_.find(t.group.customers,{id:parseInt(this.selected)})),e("horodata/widgets/configuration/customers_edit_form.html","appWidgetsConfigurationCustomersDialog",t,n)},create:function(n){return this.current={customers:""},e("horodata/widgets/configuration/customers_create_form.html","appWidgetsConfigurationCustomersDialog",t,n)}}},{link:t,restrict:"E",templateUrl:"horodata/widgets/configuration/customers.html"}}]),angular.module("horodata").controller("appWidgetsConfigurationCustomersDialog",["$scope","$mdDialog","$mdToast","$http","$location","apiService",function(e,t,n,r,o,i){var a;return e.errors=null,e.loading=!1,e.close=function(){return t.hide()},a=function(t){var n;return n=_.findIndex(e.group.customers,{id:t.id}),e.group.customers[n]=e.customers.current,e.group.customers=_.sortBy(e.group.customers,["name"])},e.create=function(){return e.loading=!0,r.post(i.get()+"/groups/"+e.group.url+"/customers",e.customers.current).then(function(r){var o;return o=r.data.data.total,e.$emit("group.reload"),t.hide(),1===o?n.showSimple("1 nouveau dossier ajouté"):n.showSimple(o+" nouveaux dossiers ajoutés")},function(t){return e.errors=t.data.errors,e.loading=!1})},e.edit=function(){return e.loading=!0,r.put(i.get()+"/groups/"+e.group.url+"/customers/"+e.customers.selected,e.customers.current).then(function(r){return t.hide(),n.showSimple("Dossier '"+e.customers.current.name+"' modifié"),a(e.customers.current),e.customers.selected=null},function(t){return e.errors=t.data.errors,e.loading=!1})},e["delete"]=function(){return e.loading=!0,r["delete"](i.get()+"/groups/"+e.group.url+"/customers/"+e.customers.selected,e.customers.current).then(function(r){return t.hide(),n.showSimple("Dossier '"+e.customers.current.name+"' supprimé"),e.group.customers.splice(_.findIndex(e.group.customers,{id:parseInt(e.customers.selected)}),1),e.customers.selected=null},function(t){return e.errors=t.data.errors,e.loading=!1})}}]),angular.module("horodata").directive("appWidgetsConfigurationGuests",["popupService",function(e){var t;return t=function(t,n,r){return t.guests={current:null,selected:null,edit:function(n){return this.current=_.cloneDeep(_.find(t.group.guests,{id:parseInt(this.selected)})),e("horodata/widgets/configuration/guests_edit_form.html","appWidgetsConfigurationGuestsDialog",t,n)},create:function(n){return this.current={email:"",admin:!1,rate:0},e("horodata/widgets/configuration/guests_create_form.html","appWidgetsConfigurationGuestsDialog",t,n)}}},{link:t,restrict:"E",templateUrl:"horodata/widgets/configuration/guests.html"}}]),angular.module("horodata").controller("appWidgetsConfigurationGuestsDialog",["$scope","$mdDialog","$mdToast","$http","$location","apiService",function(e,t,n,r,o,i){var a;return e.errors=null,e.loading=!1,e.close=function(){return t.hide()},a=function(t){var n;return n=_.findIndex(e.group.guests,{id:t.id}),e.group.guests[n]=e.guests.current,e.group.guests=_.sortBy(e.group.guests,["name"])},e.create=function(){return e.loading=!0,r.post(i.get()+"/groups/"+e.group.url+"/guests",e.guests.current).then(function(r){return e.$emit("group.reload"),t.hide(),n.showSimple("Nouvel utilisateur '"+e.guests.current.email+"' ajouté")},function(t){return e.loading=!1,e.errors=t.data.errors})},e.edit=function(){return e.loading=!0,r.put(i.get()+"/groups/"+e.group.url+"/guests/"+e.guests.selected,e.guests.current).then(function(r){return t.hide(),n.showSimple("Utilisateur '"+e.guests.current.email+"' modifié"),a(e.guests.current),e.guests.selected=null},function(t){return e.loading=!1,e.errors=t.data.errors})},e["delete"]=function(){return e.loading=!0,r["delete"](i.get()+"/groups/"+e.group.url+"/guests/"+e.guests.selected,e.guests.current).then(function(r){return t.hide(),n.showSimple("Utilisateur '"+e.guests.current.email+"' supprimé"),e.group.guests.splice(_.findIndex(e.group.guests,{id:parseInt(e.guests.selected)}),1),e.task.selected=null},function(t){return e.loading=!1,e.errors=t.data.errors})}}]),angular.module("horodata").directive("appWidgetsConfigurationTasks",["popupService",function(e){var t;return t=function(t,n,r){return t.tasks={current:null,selected:null,edit:function(n){return this.current=_.cloneDeep(_.find(t.group.tasks,{id:parseInt(this.selected)})),e("horodata/widgets/configuration/tasks_form.html","appWidgetsConfigurationTasksDialog",t,n)},create:function(n){return this.current={name:"",comment_mandatory:!1},e("horodata/widgets/configuration/tasks_form.html","appWidgetsConfigurationTasksDialog",t,n)}}},{link:t,restrict:"E",templateUrl:"horodata/widgets/configuration/tasks.html"}}]),angular.module("horodata").controller("appWidgetsConfigurationTasksDialog",["$scope","$mdDialog","$mdToast","$http","$location","apiService",function(e,t,n,r,o,i){var a;return e.errors=null,e.loading=!1,e.close=function(){return t.hide()},a=function(t){var n;return n=_.findIndex(e.group.tasks,{id:t.id}),e.group.tasks[n]=e.tasks.current,e.group.tasks=_.sortBy(e.group.tasks,["name"])},e.create=function(){return e.loading=!0,r.post(i.get()+"/groups/"+e.group.url+"/tasks",e.tasks.current).then(function(r){return e.$emit("group.reload"),t.hide(),n.showSimple("Nouveau type de tâche '"+e.tasks.current.name+"' ajouté")},function(t){return e.loading=!1,e.errors=t.data.errors})},e.edit=function(){return e.loading=!0,r.put(i.get()+"/groups/"+e.group.url+"/tasks/"+e.tasks.selected,e.tasks.current).then(function(r){return t.hide(),n.showSimple("Type de tâche '"+e.tasks.current.name+"' modifié"),a(e.tasks.current),e.tasks.selected=null},function(t){return e.loading=!1,e.errors=t.data.errors})},e["delete"]=function(){return e.loading=!0,r["delete"](i.get()+"/groups/"+e.group.url+"/tasks/"+e.tasks.selected,e.tasks.current).then(function(r){return t.hide(),n.showSimple("Type de tâche '"+e.tasks.current.name+"' supprimé"),e.group.tasks.splice(_.findIndex(e.group.tasks,{id:parseInt(e.tasks.selected)}),1),e.tasks.selected=null},function(t){return e.loading=!1,e.errors=t.data.errors})}}]),angular.module("horodata").directive("appWidgetsStatsCustomerTime",["statsService",function(e){var t;return t=function(t){return t.stats=e,e.fetch(t.group.url,"customer_time",t.search,function(e){return function(e){return t.data=e}}(this))},{link:t,replace:!0,restrict:"E",templateUrl:"horodata/widgets/stats/customer_time.html"}}]);
